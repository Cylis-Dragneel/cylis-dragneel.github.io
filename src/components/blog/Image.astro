---
interface Props {
  src: string;
  alt: string;
  caption?: string;
  size?: "small" | "medium" | "large" | "full";
  position?: "left" | "center" | "right";
  float?: "left" | "right";
}

const { src, alt, caption, size = "large", position = "center", float } = Astro.props;

const sizeClasses = {
  small: "max-w-sm",
  medium: "max-w-lg",
  large: "max-w-2xl",
  full: "max-w-full",
};

const positionClasses = {
  left: "mr-auto",
  center: "mx-auto",
  right: "ml-auto",
};

// Handle relative paths for blog images
const imageSrc = src.startsWith("http") ? src : `/blog/img/${src}`;

// When floating, override position and add float classes
const isFloating = !!float;
const floatClass = float === "left" ? "image-float-left" : float === "right" ? "image-float-right" : "";
---

<figure class:list={[
  isFloating ? "image-float" : "my-8",
  isFloating ? floatClass : "",
  sizeClasses[size],
  isFloating ? "" : positionClasses[position],
]}>
  <img
    src={imageSrc}
    alt={alt}
    class="rounded-lg shadow-lg w-full"
    loading="lazy"
  />
  {
    caption && (
      <figcaption class="mt-3 text-center text-sm text-base-400 italic img-caption">
        {caption}
      </figcaption>
    )
  }
</figure>

{isFloating && <div class="image-float-clear" />}

<style>
  .img-caption {
    color: var(--color-base-400);
  }

  .image-float {
    margin-top: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .image-float-left {
    float: left;
    margin-right: 1.5rem;
  }

  .image-float-right {
    float: right;
    margin-left: 1.5rem;
  }

  /* Clearfix element - hidden by default, placed after float content */
  .image-float-clear {
    display: none;
  }
</style>
